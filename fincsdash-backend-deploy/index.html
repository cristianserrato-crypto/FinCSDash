<!-- Define que este es un documento HTML5 moderno -->
<!DOCTYPE html>
<!-- Inicio de la etiqueta HTML, configurada en idioma espaÃ±ol -->
<html lang="es">
<head>
    <!-- Permite caracteres especiales como tildes y Ã± -->
    <meta charset="UTF-8">
    <!-- Asegura que la pÃ¡gina se vea bien en celulares (ajusta el ancho a la pantalla) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- El tÃ­tulo que aparece en la pestaÃ±a del navegador -->
    <title>FinCSDash</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Estilos -->
    <!-- Conecta este archivo con la hoja de estilos CSS para que se vea bonito -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Google Identity -->
    <!-- Carga la librerÃ­a de Google para poder iniciar sesiÃ³n con Gmail -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- ConfiguraciÃ³n de Entorno (URL del Backend) -->
    <script src="js/config.js"></script>
    <script src="js/app.js"></script>


    
    <!-- LÃ³gica -->
    <!-- Carga el archivo principal de JavaScript que controla toda la aplicaciÃ³n -->
    <!-- 'defer' significa que espera a que el HTML cargue antes de ejecutarse -->
    <script src="js/app.js" defer></script>
</head>
<body>

<!-- Encabezado de la pÃ¡gina (barra superior) -->
<header>
    <h1>FinCSDash</h1>
</header>

<!-- Contenido principal de la pÃ¡gina -->
<main>

<!-- LOGIN -->
<!-- SecciÃ³n de inicio de sesiÃ³n. Tiene un ID para poder ocultarla o mostrarla con JS -->
<section id="login-view">
    <h2>Login</h2>

    <!-- Campo de texto para escribir el email -->
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="ContraseÃ±a">

    <!-- BotÃ³n que al hacer clic ejecuta la funciÃ³n 'login()' de JavaScript -->
    <button onclick="login()">Ingresar</button>

    <!-- NUEVO: Enlace para restablecer contraseÃ±a -->
    <a href="#" onclick="showForgotPassword()" style="text-align: center; display: block; margin-top: 10px; font-size: 0.9rem; color: var(--primary);">Â¿Olvidaste tu contraseÃ±a?</a>

    <!-- Contenedor vacÃ­o donde Google dibujarÃ¡ su botÃ³n de "Iniciar sesiÃ³n" -->
    <div id="googleBtn"></div>

    <!-- PÃ¡rrafo vacÃ­o para mostrar mensajes de error o Ã©xito -->
    <p id="loginMsg"></p>

    <!-- BotÃ³n para cambiar a la vista de registro -->
    <button onclick="showRegister()">Registrarse</button>
</section>

<!-- REGISTRO -->
<!-- SecciÃ³n de registro. 'style="display:none;"' significa que inicia oculta -->
<section id="register-view" style="display:none;">
    <h2>Registro</h2>

    <input type="email" id="registerEmail" placeholder="Email">
    <input type="password" id="registerPassword" placeholder="ContraseÃ±a">

    <!-- NUEVO: Barra de seguridad de contraseÃ±a -->
    <div id="password-strength-container" style="display: none; margin-top: 5px; margin-bottom: 10px;">
        <div id="password-strength-bar"></div>
        <small id="password-strength-text"></small>
    </div>

    <!-- Ejecuta la funciÃ³n 'register()' al hacer clic -->
    <button onclick="register()">Registrar</button>

    <p id="registerMsg"></p>

    <!-- BotÃ³n para volver a la pantalla de login -->
    <button onclick="showLogin()">Volver</button>
</section>

<!-- VERIFICACIÃ“N -->
<!-- SecciÃ³n para ingresar el cÃ³digo que llega al correo -->
<section id="verify-view" style="display:none;">
    <h2>Verificar cuenta</h2>

    <input type="email" id="verifyEmail" placeholder="Email" readonly>
    <input type="text" id="verifyCode" placeholder="CÃ³digo">

    <!-- Ejecuta la funciÃ³n 'verify()' para validar el cÃ³digo -->
    <button onclick="verify()">Verificar</button>

    <p id="verifyMsg"></p>

    <p>Â¿No recibiste el cÃ³digo?</p>
    <button id="resendBtn" onclick="resendCode()">Reenviar cÃ³digo</button>
    <p id="resendMsg"></p>
</section>

<!-- NUEVO: OLVIDO DE CONTRASEÃ‘A -->
<section id="forgot-password-view" style="display:none;">
    <h2>Restablecer ContraseÃ±a</h2>
    <p style="text-align: center; margin-top: -10px; margin-bottom: 20px; font-size: 0.9rem;" class="text-muted">
        Ingresa tu correo y te enviaremos un token para crear una nueva contraseÃ±a.
    </p>
    <input type="email" id="forgotEmail" placeholder="Email">
    <button onclick="requestPasswordReset()">Enviar Token</button>
    <p id="forgotMsg"></p>
    <button onclick="showLogin()" class="btn-secondary">Volver al Login</button>
</section>

<!-- NUEVO: RESETEAR CONTRASEÃ‘A CON TOKEN -->
<section id="reset-password-view" style="display:none;">
    <h2>Crear Nueva ContraseÃ±a</h2>
    <p style="text-align: center; margin-top: -10px; margin-bottom: 20px; font-size: 0.9rem;" class="text-muted">
        Ingresa el token que recibiste en tu correo y tu nueva contraseÃ±a.
    </p>
    <input type="text" id="resetToken" placeholder="Token de reseteo">
    <input type="password" id="resetPassword" placeholder="Nueva ContraseÃ±a">
    <!-- Barra de seguridad para la nueva contraseÃ±a -->
    <div id="reset-password-strength-container" style="display: none; margin-top: -5px; margin-bottom: 10px;">
        <div id="reset-password-strength-bar"></div>
        <small id="reset-password-strength-text"></small>
    </div>
    <button onclick="resetPasswordWithToken()">Actualizar ContraseÃ±a</button>
    <p id="resetMsg"></p>
</section>

<!-- ONBOARDING (CONFIGURACIÃ“N INICIAL) -->
<section id="onboarding-view" style="display:none;">
    <!-- Paso 1: Ingresos -->
    <div id="onboarding-step-1">
        <h2>ğŸ‘‹ Â¡Bienvenido!</h2>
        <p>Configuremos tus finanzas en 3 pasos.</p>
        
        <label class="form-label">Â¿CuÃ¡l es tu ingreso mensual aproximado?</label>
        <input type="number" id="setupIncome" placeholder="$ 0.00" class="form-control">
        
        <label class="form-label">Â¿QuÃ© dÃ­a del mes recibes tu pago?</label>
        <input type="number" id="setupPayDay" placeholder="Ej: 15" min="1" max="31" class="form-control">
        
        <button onclick="nextOnboardingStep(2)" class="btn btn-primary w-100" style="margin-top:20px;">Siguiente â¡</button>
    </div>

    <!-- Paso 2: Gastos Fijos -->
    <div id="onboarding-step-2" style="display:none;">
        <h2>ğŸ“… Gastos Fijos</h2>
        <p>Registra tus pagos recurrentes (Arriendo, Internet, etc.) y quÃ© dÃ­a debes pagarlos.</p>
        
        <div id="recurring-expenses-list">
            <!-- AquÃ­ se agregarÃ¡n los inputs dinÃ¡micamente -->
        </div>
        
        <button onclick="addRecurringRow()" class="btn btn-secondary btn-sm w-100" style="margin-bottom:15px;">ï¼‹ Agregar otro gasto</button>
        
        <div class="flex-gap">
            <button onclick="nextOnboardingStep(1)" class="btn btn-secondary">â¬… AtrÃ¡s</button>
            <button onclick="finishOnboarding()" class="btn btn-success w-100">Finalizar âœ…</button>
        </div>
    </div>

    <!-- Paso 3: Ã‰xito -->
    <div id="onboarding-step-3" style="display:none; text-align:center;">
        <h2 style="color: var(--success);">Â¡Todo listo! ğŸ‰</h2>
        <p>Hemos configurado tu perfil.</p>
        <div style="background: #e6fffa; padding: 15px; border-radius: 8px; border: 1px solid #b2f5ea; margin: 20px 0;">
            <strong>ğŸ”” Notificaciones Activadas</strong>
            <p style="font-size: 0.9rem; margin-top: 5px;">
                Te avisaremos en los dÃ­as programados para que no olvides realizar tus pagos pendientes.
            </p>
        </div>
        <p>Ahora verÃ¡s el estado real de tus finanzas.</p>
        <button onclick="completeOnboarding()" class="btn btn-primary w-100">Ir al Dashboard</button>
    </div>
</section>

<!-- NUEVO: PERFIL INICIAL -->
<section id="initial-profile-view" style="display:none;">
    <h2>Completa tu perfil</h2>
    <p>Necesitamos algunos datos para empezar.</p>
    
    <label class="form-label">Nombre(s)</label>
    <input type="text" id="profileNombre" placeholder="Tu nombre" class="form-control">
    
    <label class="form-label">Apellido(s)</label>
    <input type="text" id="profileApellidos" placeholder="Tus apellidos" class="form-control">
    
    <label class="form-label">Edad</label>
    <input type="number" id="profileEdad" placeholder="Tu edad" class="form-control">
    
    <button onclick="saveInitialProfile()" class="btn btn-primary w-100" style="margin-top:20px;">Guardar y Continuar</button>
</section>

<!-- DASHBOARD -->
<!-- SecciÃ³n principal del usuario, inicia oculta hasta que se loguee -->
<section id="dashboard-view" style="display:none;">
    <h2>Dashboard</h2>
    <!-- AquÃ­ se mostrarÃ¡ el correo del usuario conectado -->
    <p>Bienvenido <b id="userEmail"></b></p>
    <!-- BotÃ³n para cerrar sesiÃ³n -->
    <button onclick="logout()">Cerrar sesiÃ³n</button>
</section>

</main>

<!-- MODAL EDITAR GASTO RECURRENTE -->
<div id="edit-recurring-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">âœï¸ Editar Pago</h3>
        <p id="editRecCategoryDisplay" class="text-muted" style="margin-bottom: 20px;"></p>
        
        <input type="hidden" id="editRecId">
        
        <label class="form-label">Nuevo Monto</label>
        <input type="number" id="editRecAmount" class="form-control form-group">
        
        <label class="form-label">DÃ­a de Pago (1-31)</label>
        <input type="number" id="editRecDay" class="form-control form-group" min="1" max="31">
        
        <div class="flex-gap">
            <button onclick="deleteRecurringExpense()" class="btn btn-danger" style="width: auto;" title="Eliminar">ğŸ—‘ï¸</button>
            <button onclick="closeModal('edit-recurring-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveRecurringEdit()" class="btn btn-primary">Guardar</button>
        </div>
    </div>
</div>

<!-- MODAL NUEVA META -->
<div id="add-savings-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">ğŸ¯ Nueva Meta</h3>
        
        <label class="form-label">Nombre (ej: Viaje)</label>
        <input type="text" id="newSavingsName" class="form-control form-group">
        
        <label class="form-label">Monto Objetivo ($)</label>
        <input type="number" id="newSavingsTarget" class="form-control form-group">
        
        <label class="form-label">Fecha LÃ­mite</label>
        <input type="date" id="newSavingsDate" class="form-control form-group">
        
        <!-- NUEVO: Selector de Moneda -->
        <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background: var(--bg-body); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
            <input type="checkbox" id="isUsdGoal" style="width: 18px; height: 18px; cursor: pointer;">
            <label for="isUsdGoal" style="margin: 0; cursor: pointer; font-size: 0.9rem;">ğŸ’µ Ahorrar en DÃ³lares (USD)</label>
        </div>
        
        <div class="flex-gap">
            <button onclick="closeModal('add-savings-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveSavingsGoal()" class="btn btn-primary">Crear</button>
        </div>
    </div>
</div>

<!-- MODAL EDITAR PERFIL -->
<div id="edit-profile-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">ğŸ‘¤ Editar Perfil</h3>
        
        <label class="form-label">Nombre</label>
        <input type="text" id="editProfileName" class="form-control form-group" placeholder="Tu nombre">
        
        <label class="form-label">Nueva ContraseÃ±a (Opcional)</label>
        <input type="password" id="editProfilePassword" class="form-control form-group" placeholder="Dejar vacÃ­o para no cambiar">
        
        <div class="flex-gap">
            <button onclick="closeModal('edit-profile-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveProfileUpdate()" class="btn btn-primary">Guardar</button>
        </div>
    </div>
</div>

<!-- MODAL ACTUALIZAR AHORRO -->
<div id="update-savings-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">ğŸ’° Actualizar Ahorro</h3>
        <p id="updateSavingsNameDisplay" class="text-muted"></p>
        <input type="hidden" id="updateSavingsId">
        <input type="hidden" id="updateSavingsCurrent">
        
        <label class="form-label">Monto a agregar ($)</label>
        <input type="number" id="addSavingsAmount" class="form-control form-group" placeholder="0.00">
        
        <!-- NUEVO: Checkbox para descontar del saldo -->
        <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background: var(--bg-body); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
            <input type="checkbox" id="deductFromBalance" style="width: 18px; height: 18px; cursor: pointer;" checked>
            <label for="deductFromBalance" style="margin: 0; cursor: pointer; font-size: 0.9rem;">ğŸ“‰ Descontar del saldo (Registrar Gasto)</label>
        </div>

        <div class="flex-gap">
            <button onclick="closeModal('update-savings-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveSavingsUpdate()" class="btn btn-success">Agregar</button>
        </div>
    </div>
</div>

<!-- CHATBOT FLOTANTE -->
<button id="chatbot-btn" onclick="toggleChat()" title="Asistente Virtual">ğŸ’¬</button>

<div id="chatbot-window">
    <div class="chat-header">
        <h4>ğŸ¤– Asistente FinCS</h4>
        <button onclick="toggleChat()" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">âœ–</button>
    </div>
    <div id="chat-messages" class="chat-body">
        <!-- Los mensajes se cargarÃ¡n dinÃ¡micamente -->
    </div>
    <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="Escribe aquÃ­..." onkeypress="handleChatKey(event)">
        <button onclick="sendChatMessage()">â¤</button>
    </div>
</div>

</body>
</html>
