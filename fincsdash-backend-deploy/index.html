<!-- Define que este es un documento HTML5 moderno -->
<!DOCTYPE html>
<!-- Inicio de la etiqueta HTML, configurada en idioma espa√±ol -->
<html lang="es">
<head>
    <!-- Permite caracteres especiales como tildes y √± -->
    <meta charset="UTF-8">
    <!-- Asegura que la p√°gina se vea bien en celulares (ajusta el ancho a la pantalla) -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- El t√≠tulo que aparece en la pesta√±a del navegador -->
    <title>FinCSDash</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Estilos -->
    <!-- Conecta este archivo con la hoja de estilos CSS para que se vea bonito -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Google Identity -->
    <!-- Carga la librer√≠a de Google para poder iniciar sesi√≥n con Gmail -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Configuraci√≥n de Entorno (URL del Backend) -->
    <script src="js/config.js"></script>
    <!-- L√≥gica -->
    <!-- Carga el archivo principal de JavaScript que controla toda la aplicaci√≥n -->
    <!-- 'defer' significa que espera a que el HTML cargue antes de ejecutarse -->
    <script src="js/app.js" defer></script>
</head>
<body>

<!-- Encabezado de la p√°gina (barra superior) -->
<header>
    <h1>FinCSDash</h1>
</header>

<!-- Contenido principal de la p√°gina -->
<main>

<!-- LOGIN -->
<!-- Secci√≥n de inicio de sesi√≥n. Tiene un ID para poder ocultarla o mostrarla con JS -->
<section id="login-view">
    <h2>Login</h2>

    <!-- Campo de texto para escribir el email -->
    <input type="email" id="loginEmail" placeholder="Email">
    <input type="password" id="loginPassword" placeholder="Contrase√±a">

    <!-- Bot√≥n que al hacer clic ejecuta la funci√≥n 'login()' de JavaScript -->
    <button onclick="login()">Ingresar</button>

    <!-- NUEVO: Enlace para restablecer contrase√±a -->
    <a href="#" onclick="showForgotPassword()" style="text-align: center; display: block; margin-top: 10px; font-size: 0.9rem; color: var(--primary);">¬øOlvidaste tu contrase√±a?</a>

    <!-- Contenedor vac√≠o donde Google dibujar√° su bot√≥n de "Iniciar sesi√≥n" -->
    <div id="googleBtn"></div>

    <!-- P√°rrafo vac√≠o para mostrar mensajes de error o √©xito -->
    <p id="loginMsg"></p>

    <!-- Bot√≥n para cambiar a la vista de registro -->
    <button onclick="showRegister()">Registrarse</button>
</section>

<!-- REGISTRO -->
<!-- Secci√≥n de registro. 'style="display:none;"' significa que inicia oculta -->
<section id="register-view" style="display:none;">
    <h2>Registro</h2>

    <input type="email" id="registerEmail" placeholder="Email">
    <input type="password" id="registerPassword" placeholder="Contrase√±a">

    <!-- NUEVO: Barra de seguridad de contrase√±a -->
    <div id="password-strength-container" style="display: none; margin-top: 5px; margin-bottom: 10px;">
        <div id="password-strength-bar"></div>
        <small id="password-strength-text"></small>
    </div>

    <!-- Ejecuta la funci√≥n 'register()' al hacer clic -->
    <button onclick="register()">Registrar</button>

    <p id="registerMsg"></p>

    <!-- Bot√≥n para volver a la pantalla de login -->
    <button onclick="showLogin()">Volver</button>
</section>

<!-- VERIFICACI√ìN -->
<!-- Secci√≥n para ingresar el c√≥digo que llega al correo -->
<section id="verify-view" style="display:none;">
    <h2>Verificar cuenta</h2>

    <input type="email" id="verifyEmail" placeholder="Email" readonly>
    <input type="text" id="verifyCode" placeholder="C√≥digo">

    <!-- Ejecuta la funci√≥n 'verify()' para validar el c√≥digo -->
    <button onclick="verify()">Verificar</button>

    <p id="verifyMsg"></p>

    <p>¬øNo recibiste el c√≥digo?</p>
    <button id="resendBtn" onclick="resendCode()">Reenviar c√≥digo</button>
    <p id="resendMsg"></p>
</section>

<!-- NUEVO: OLVIDO DE CONTRASE√ëA -->
<section id="forgot-password-view" style="display:none;">
    <h2>Restablecer Contrase√±a</h2>
    <p style="text-align: center; margin-top: -10px; margin-bottom: 20px; font-size: 0.9rem;" class="text-muted">
        Ingresa tu correo y te enviaremos un token para crear una nueva contrase√±a.
    </p>
    <input type="email" id="forgotEmail" placeholder="Email">
    <button onclick="requestPasswordReset()">Enviar Token</button>
    <p id="forgotMsg"></p>
    <button onclick="showLogin()" class="btn-secondary">Volver al Login</button>
</section>

<!-- NUEVO: RESETEAR CONTRASE√ëA CON TOKEN -->
<section id="reset-password-view" style="display:none;">
    <h2>Crear Nueva Contrase√±a</h2>
    <p style="text-align: center; margin-top: -10px; margin-bottom: 20px; font-size: 0.9rem;" class="text-muted">
        Ingresa el token que recibiste en tu correo y tu nueva contrase√±a.
    </p>
    <input type="text" id="resetToken" placeholder="Token de reseteo">
    <input type="password" id="resetPassword" placeholder="Nueva Contrase√±a">
    <!-- Barra de seguridad para la nueva contrase√±a -->
    <div id="reset-password-strength-container" style="display: none; margin-top: -5px; margin-bottom: 10px;">
        <div id="reset-password-strength-bar"></div>
        <small id="reset-password-strength-text"></small>
    </div>
    <button onclick="resetPasswordWithToken()">Actualizar Contrase√±a</button>
    <p id="resetMsg"></p>
</section>

<!-- T√âRMINOS Y CONDICIONES -->
<section id="terms-view" style="display:none;">
    <h2>üìú T√©rminos y Condiciones</h2>
    <p style="text-align: center; margin-bottom: 15px;">Por favor, lee y acepta para continuar.</p>
    
    <div style="height: 350px; overflow-y: auto; border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; background: #fff; color: #333; text-align: left; border-radius: 8px; font-size: 0.9rem; line-height: 1.5;">
        <p><strong>üìú T√©rminos, Condiciones y Pol√≠tica de Privacidad ‚Äì FinCSDash</strong></p>
        <p>Al utilizar la plataforma FinCSDash, el usuario acepta los presentes T√©rminos y Condiciones de Uso, as√≠ como la Pol√≠tica de Privacidad y Tratamiento de Datos Personales.</p>

        <p><strong>1. Objeto del servicio</strong><br>
        FinCSDash es una plataforma digital destinada a la gesti√≥n y visualizaci√≥n de informaci√≥n financiera personal. La plataforma tiene fines informativos y de apoyo en la organizaci√≥n de finanzas personales. FinCSDash no ofrece asesor√≠a financiera, contable, legal o de inversi√≥n, ni garantiza resultados econ√≥micos derivados del uso de la aplicaci√≥n.</p>

        <p><strong>2. Responsabilidad del usuario</strong><br>
        El usuario es responsable de la veracidad, actualizaci√≥n y legalidad de la informaci√≥n que registra en la plataforma. FinCSDash no se hace responsable por decisiones financieras, p√©rdidas econ√≥micas o consecuencias derivadas del uso de la informaci√≥n presentada en la aplicaci√≥n.</p>

        <p><strong>3. Seguridad de la cuenta</strong><br>
        El usuario es responsable de la confidencialidad de sus credenciales de acceso. Cualquier actividad realizada desde su cuenta ser√° considerada como realizada por el propio usuario. FinCSDash no se responsabiliza por accesos no autorizados derivados del uso indebido o negligente de las credenciales por parte del usuario.</p>

        <p><strong>4. Tratamiento de datos personales</strong><br>
        FinCSDash recopila y procesa datos personales tales como correo electr√≥nico, informaci√≥n de perfil y datos financieros ingresados por el usuario, exclusivamente con el fin de prestar el servicio.<br>
        La informaci√≥n se almacena de forma segura en infraestructura en la nube (Amazon Web Services ‚Äì AWS). FinCSDash no vende, alquila ni comparte datos personales con terceros, salvo cuando sea requerido por obligaci√≥n legal o autorizaci√≥n expresa del usuario.</p>

        <p><strong>5. Protecci√≥n de la informaci√≥n</strong><br>
        Se aplican medidas t√©cnicas y organizativas razonables para proteger la informaci√≥n del usuario frente a accesos no autorizados, p√©rdida o alteraci√≥n. No obstante, el usuario reconoce que ning√∫n sistema es completamente infalible.</p>

        <p><strong>6. Disponibilidad del servicio</strong><br>
        FinCSDash podr√° presentar interrupciones temporales por mantenimiento, mejoras, fallos t√©cnicos o causas externas. No se garantiza la disponibilidad ininterrumpida del servicio ni la ausencia de errores.</p>

        <p><strong>7. Eliminaci√≥n de cuenta y datos</strong><br>
        El usuario podr√° solicitar la eliminaci√≥n de su cuenta. FinCSDash eliminar√° la informaci√≥n asociada, salvo aquella que deba conservarse por obligaciones legales o razones t√©cnicas leg√≠timas.</p>

        <p><strong>8. Propiedad intelectual</strong><br>
        El software, dise√±o, marcas y contenido de FinCSDash son propiedad de sus desarrolladores. Queda prohibida la reproducci√≥n, modificaci√≥n o distribuci√≥n no autorizada de la plataforma.</p>

        <p><strong>9. Modificaciones de los t√©rminos</strong><br>
        FinCSDash se reserva el derecho de modificar los presentes t√©rminos en cualquier momento. Los cambios ser√°n informados dentro de la plataforma y el uso continuado del servicio implica la aceptaci√≥n de los nuevos t√©rminos.</p>

        <p><strong>10. Aceptaci√≥n</strong><br>
        El uso de FinCSDash implica la aceptaci√≥n expresa de los presentes T√©rminos, Condiciones y Pol√≠tica de Privacidad.</p>
    </div>

    <div class="flex-gap">
        <button onclick="cancelTerms()" class="btn btn-secondary">Cancelar</button>
        <button onclick="acceptTerms()" class="btn btn-primary">Aceptar</button>
    </div>
</section>

<!-- ONBOARDING (CONFIGURACI√ìN INICIAL) -->
<section id="onboarding-view" style="display:none;">
    <!-- Paso 1: Ingresos -->
    <div id="onboarding-step-1">
        <h2>üëã ¬°Bienvenido!</h2>
        <p>Configuremos tus finanzas en 3 pasos.</p>
        
        <label class="form-label">¬øCu√°l es tu ingreso mensual aproximado?</label>
        <input type="number" id="setupIncome" placeholder="$ 0.00" class="form-control">
        
        <label class="form-label">¬øQu√© d√≠a del mes recibes tu pago?</label>
        <input type="number" id="setupPayDay" placeholder="Ej: 15" min="1" max="31" class="form-control">
        
        <button onclick="nextOnboardingStep(2)" class="btn btn-primary w-100" style="margin-top:20px;">Siguiente ‚û°</button>
    </div>

    <!-- Paso 2: Gastos Fijos -->
    <div id="onboarding-step-2" style="display:none;">
        <h2>üìÖ Gastos Fijos</h2>
        <p>Registra tus pagos recurrentes (Arriendo, Internet, etc.) y qu√© d√≠a debes pagarlos.</p>
        
        <div id="recurring-expenses-list">
            <!-- Aqu√≠ se agregar√°n los inputs din√°micamente -->
        </div>
        
        <button onclick="addRecurringRow()" class="btn btn-secondary btn-sm w-100" style="margin-bottom:15px;">Ôºã Agregar otro gasto</button>
        
        <div class="flex-gap">
            <button onclick="nextOnboardingStep(1)" class="btn btn-secondary">‚¨Ö Atr√°s</button>
            <button onclick="finishOnboarding()" class="btn btn-success w-100">Finalizar ‚úÖ</button>
        </div>
    </div>

    <!-- Paso 3: √âxito -->
    <div id="onboarding-step-3" style="display:none; text-align:center;">
        <h2 style="color: var(--success);">¬°Todo listo! üéâ</h2>
        <p>Hemos configurado tu perfil.</p>
        <div style="background: #e6fffa; padding: 15px; border-radius: 8px; border: 1px solid #b2f5ea; margin: 20px 0;">
            <strong>üîî Notificaciones Activadas</strong>
            <p style="font-size: 0.9rem; margin-top: 5px;">
                Te avisaremos en los d√≠as programados para que no olvides realizar tus pagos pendientes.
            </p>
        </div>
        <p>Ahora ver√°s el estado real de tus finanzas.</p>
        <button onclick="completeOnboarding()" class="btn btn-primary w-100">Ir al Dashboard</button>
    </div>
</section>

<!-- NUEVO: PERFIL INICIAL -->
<section id="initial-profile-view" style="display:none;">
    <h2>Completa tu perfil</h2>
    <p>Necesitamos algunos datos para empezar.</p>
    
    <label class="form-label">Nombre(s)</label>
    <input type="text" id="profileNombre" placeholder="Tu nombre" class="form-control">
    
    <label class="form-label">Apellido(s)</label>
    <input type="text" id="profileApellidos" placeholder="Tus apellidos" class="form-control">
    
    <label class="form-label">Edad</label>
    <input type="number" id="profileEdad" placeholder="Tu edad" class="form-control">
    
    <button onclick="saveInitialProfile()" class="btn btn-primary w-100" style="margin-top:20px;">Guardar y Continuar</button>
</section>

<!-- DASHBOARD -->
<!-- Secci√≥n principal del usuario, inicia oculta hasta que se loguee -->
<section id="dashboard-view" style="display:none;">
    <h2>Dashboard</h2>
    <!-- Aqu√≠ se mostrar√° el correo del usuario conectado -->
    <p>Bienvenido <b id="userEmail"></b></p>
    <!-- Bot√≥n para cerrar sesi√≥n -->
    <button onclick="logout()">Cerrar sesi√≥n</button>
</section>

</main>

<!-- MODAL EDITAR GASTO RECURRENTE -->
<div id="edit-recurring-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">‚úèÔ∏è Editar Pago</h3>
        <p id="editRecCategoryDisplay" class="text-muted" style="margin-bottom: 20px;"></p>
        
        <input type="hidden" id="editRecId">
        
        <label class="form-label">Nuevo Monto</label>
        <input type="number" id="editRecAmount" class="form-control form-group">
        
        <label class="form-label">D√≠a de Pago (1-31)</label>
        <input type="number" id="editRecDay" class="form-control form-group" min="1" max="31">
        
        <div class="flex-gap">
            <button onclick="deleteRecurringExpense()" class="btn btn-danger" style="width: auto;" title="Eliminar">üóëÔ∏è</button>
            <button onclick="closeModal('edit-recurring-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveRecurringEdit()" class="btn btn-primary">Guardar</button>
        </div>
    </div>
</div>

<!-- MODAL NUEVA META -->
<div id="add-savings-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">üéØ Nueva Meta</h3>
        
        <label class="form-label">Nombre (ej: Viaje)</label>
        <input type="text" id="newSavingsName" class="form-control form-group">
        
        <label class="form-label">Monto Objetivo ($)</label>
        <input type="number" id="newSavingsTarget" class="form-control form-group">
        
        <label class="form-label">Fecha L√≠mite</label>
        <input type="date" id="newSavingsDate" class="form-control form-group">
        
        <!-- NUEVO: Selector de Moneda -->
        <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background: var(--bg-body); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
            <input type="checkbox" id="isUsdGoal" style="width: 18px; height: 18px; cursor: pointer;">
            <label for="isUsdGoal" style="margin: 0; cursor: pointer; font-size: 0.9rem;">üíµ Ahorrar en D√≥lares (USD)</label>
        </div>
        
        <div class="flex-gap">
            <button onclick="closeModal('add-savings-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveSavingsGoal()" class="btn btn-primary">Crear</button>
        </div>
    </div>
</div>

<!-- MODAL EDITAR PERFIL -->
<div id="edit-profile-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">üë§ Editar Perfil</h3>
        
        <label class="form-label">Nombre</label>
        <input type="text" id="editProfileName" class="form-control form-group" placeholder="Tu nombre">
        
        <label class="form-label">Nueva Contrase√±a (Opcional)</label>
        <input type="password" id="editProfilePassword" class="form-control form-group" placeholder="Dejar vac√≠o para no cambiar">
        
        <div class="flex-gap">
            <button onclick="closeModal('edit-profile-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveProfileUpdate()" class="btn btn-primary">Guardar</button>
        </div>
    </div>
</div>

<!-- MODAL ACTUALIZAR AHORRO -->
<div id="update-savings-modal" class="modal-overlay">
    <div class="card" style="width: 350px; max-width: 90%; margin: 0;">
        <h3 style="margin-bottom: 15px;">üí∞ Actualizar Ahorro</h3>
        <p id="updateSavingsNameDisplay" class="text-muted"></p>
        <input type="hidden" id="updateSavingsId">
        <input type="hidden" id="updateSavingsCurrent">
        
        <label class="form-label">Monto a agregar ($)</label>
        <input type="number" id="addSavingsAmount" class="form-control form-group" placeholder="0.00">
        
        <!-- NUEVO: Checkbox para descontar del saldo -->
        <div style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px; background: var(--bg-body); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
            <input type="checkbox" id="deductFromBalance" style="width: 18px; height: 18px; cursor: pointer;" checked>
            <label for="deductFromBalance" style="margin: 0; cursor: pointer; font-size: 0.9rem;">üìâ Descontar del saldo (Registrar Gasto)</label>
        </div>

        <div class="flex-gap">
            <button onclick="closeModal('update-savings-modal')" class="btn btn-secondary">Cancelar</button>
            <button onclick="saveSavingsUpdate()" class="btn btn-success">Agregar</button>
        </div>
    </div>
</div>

<!-- CHATBOT FLOTANTE -->
<button id="chatbot-btn" onclick="toggleChat()" title="Asistente Virtual">üí¨</button>

<div id="chatbot-window">
    <div class="chat-header">
        <h4>ü§ñ Asistente FinCS</h4>
        <button onclick="toggleChat()" style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">‚úñ</button>
    </div>
    <div id="chat-messages" class="chat-body">
        <!-- Los mensajes se cargar√°n din√°micamente -->
    </div>
    <div class="chat-input-area">
        <input type="text" id="chatInput" placeholder="Escribe aqu√≠..." onkeypress="handleChatKey(event)">
        <button onclick="sendChatMessage()">‚û§</button>
    </div>
</div>

</body>
</html>
